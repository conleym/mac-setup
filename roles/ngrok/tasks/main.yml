# Download and install ngrok
#
# Set ngrok_force_install to reinstall.
---
- stat:
    path: /usr/local/bin/ngrok
  register: throwaway
  when: not ngrok_force_install

- block:
  - name: Download ngrok
    get_url:
      url: "https://bin.equinox.io/c/{{ ngrok_hash }}/ngrok-stable-darwin-amd64.zip"
      dest: "{{ downloads }}/ngrok.zip"
  - name: Unzip ngrok
    unarchive:
      dest: "{{ downloads }}"
      src: "{{ downloads }}/ngrok.zip"
  - name: Install ngrok
    command: "mv {{ downloads }}/ngrok /usr/local/bin"
    become: yes
  when: ngrok_force_install or not(throwaway.stat.executable is defined and throwaway.stat.executable)
